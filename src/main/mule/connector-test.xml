<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:crypto="http://www.mulesoft.org/schema/mule/crypto" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
      xmlns:cw="http://www.mulesoft.org/schema/mule/cw"
      xmlns:weather="http://www.mulesoft.org/schema/mule/weather" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/weather http://www.mulesoft.org/schema/mule/weather/current/mule-weather.xsd
http://www.mulesoft.org/schema/mule/cw http://www.mulesoft.org/schema/mule/cw/current/mule-cw.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/crypto http://www.mulesoft.org/schema/mule/crypto/current/mule-crypto.xsd">
	<flow name="blindJSON" doc:id="2320e0de-0214-42ef-8252-da76d34a55af" >
		<http:listener doc:name="Listener" doc:id="80124f62-ee35-40df-9439-4a8ddde85fc2" config-ref="HTTP_Listener_config" path="/blindJSON" allowedMethods="GET" />
		<set-variable value='#["12345"]' doc:name="Tweak" doc:id="5222c65d-7d9c-4fbc-a93c-3aa49931e7f9" variableName="tweak" />
		<cw:encrypt-json doc:name="Encrypt json" doc:id="310689e7-b141-4bd2-b8c6-bc73a8eba70e" config-ref="CW_Config" sensitiveFields="#[write(payload.SensitiveFields, 'application/json')]" sensitiveJson="#[write(payload.SensitiveJSON, 'application/json')]" tweak="#[vars.tweak]" passPhrase="#[attributes.headers.tokenPassPhrase]" overRideToken="#[attributes.headers.overRideToken]"/>
	
</flow>
	<flow name="clearJSON" doc:id="8fcf8e85-511c-4474-8378-e4e6acfde524" >
		<http:listener doc:name="Listener" doc:id="a5d62a39-1576-4d3b-8d47-a56ec3bef141" config-ref="HTTP_Listener_config" path="/clearJSON" />
		<set-variable value='#["12345"]' doc:name="Tweak" doc:id="f7286e2b-82c8-4c86-a8f1-683d13327479" variableName="tweak" />
		<cw:decrypt-json doc:name="Decrypt json" doc:id="799afb2e-cf9c-4466-bb52-6a8cc38dc4bb" config-ref="CW_Config" sensitiveFields="#[write(payload.SensitiveFields, 'application/json')]" encryptedJson="#[write(payload.SensitiveJSON, 'application/json')]" tweak="#[vars.tweak]" passPhrase="PASSPHRASE"/>
	
</flow>
	<flow name="createToken" doc:id="59b47141-0d1f-4e0b-92ce-579058aa0474" >
		<http:listener doc:name="Listener" doc:id="ced3403e-bd05-41ad-acc2-adcbe85fdfc8" config-ref="HTTP_Listener_config" path="/createToken"/>
		<cw:create-override-token doc:name="Create override token" doc:id="0dde0d2e-9cda-47d0-b228-56cd02662660" config-ref="CW_Config" passPhrase="#[payload.passPhrase]" expirationSecs="#[payload.expirationSeconds]"/>
	</flow>

</mule>